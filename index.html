<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>空投抢购倒计时计算器</title>
    <style>
        :root {
            --primary-color: #4A90E2;
            --bg-color: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-main: #333333;
            --text-sub: #666666;
            --highlight: #E74C3C; /* 红色高亮 */
            --placeholder: #333333; /* 占位符颜色 */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#dbe3ea 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background: var(--card-bg);
            width: 100%;
            max-width: 420px;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h2 {
            margin: 0;
            color: var(--text-main);
            font-weight: 600;
            font-size: 22px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            color: var(--text-sub);
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        /* 输入框和图标的容器 */
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        input[type="number"], 
        input[type="time"] {
            width: 100%;
            padding: 16px 40px 16px 16px; /* 留出右侧空间给图标 */
            font-size: 16px;
            border: 2px solid transparent;
            border-radius: 12px;
            background-color: #F0F2F5;
            color: var(--text-main);
            box-sizing: border-box;
            outline: none;
            transition: all 0.3s ease;
        }
        
        /* === 核心修正：隐藏浏览器自带的时间选择器图标 === */
        input[type="time"]::-webkit-calendar-picker-indicator {
            display: none;
        }
        
        input[type="time"] {
            /* 恢复右侧填充，确保文本不会被我们的自定义图标遮挡 */
            padding-right: 40px; 
        }
        /* ============================================== */

        input:focus {
            background-color: #fff;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }

        /* 统一的图标容器 */
        .input-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            opacity: 0.6;
            background-size: cover;
            z-index: 10;
            transition: opacity 0.2s;
        }
        
        /* 清空图标样式 (数字输入框和时间输入框有值时) */
        .icon-clear {
            cursor: pointer;
            /* 灰色圆圈叉 SVG */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='9' fill='%23BDBDBD'/%3E%3Cpath d='M13.41 12l3.29-3.29a1 1 0 10-1.42-1.42L12 10.59l-3.29-3.3a1 1 0 00-1.42 1.42l3.29 3.29-3.29 3.29a1 1 0 001.42 1.42l3.29-3.29 3.29 3.29a1 1 0 001.42-1.42z' fill='%23fff'/%3E%3C/svg%3E");
        }

        /* 时间图标样式 (时间输入框无值时) */
        .icon-time {
            cursor: default;
            /* 时钟 SVG */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23999' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
        }
        
        /* 隐藏数字输入框箭头 */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Result Styles (略) */
        .result-box {
            margin-top: 35px;
            padding-top: 25px;
            border-top: 1px dashed #E0E0E0;
            text-align: left;
        }
        .result-text {
            font-size: 18px;
            line-height: 1.8;
            color: var(--text-main);
        }
        .time-text {
            font-size: 24px;
            font-weight: 700;
            font-family: "Monaco", "Menlo", monospace;
            padding: 0 4px;
        }
        .time-active {
            color: var(--highlight);
        }
        .time-placeholder {
            color: var(--placeholder);
        }
        .error-msg {
            color: var(--highlight);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <h2>空投时间计算器</h2>
    </div>

    <div class="input-group">
        <div class="input-wrapper">
            <input type="number" id="currentScore" placeholder="请输入当前积分">
            <div class="input-icon icon-clear" id="iconScore" style="display: none;"></div>
        </div>
    </div>

    <div class="input-group">
        <div class="input-wrapper">
            <input type="number" id="startThreshold" placeholder="请输入空投积分门槛 (初始)">
            <div class="input-icon icon-clear" id="iconThreshold" style="display: none;"></div>
        </div>
    </div>

    <div class="input-group">
        <label for="startTime">请输入空投开始时间</label>
        <div class="input-wrapper">
            <input type="time" id="startTime">
            <div class="input-icon" id="iconTime"></div>
        </div>
    </div>

    <div class="result-box">
        <div id="resultText" class="result-text">
            <span class="time-text time-placeholder">--:--</span> 可以抢空投！<br>
        </div>
        <div id="errorMsg" class="error-msg"></div>
    </div>
</div>

<script>
    // 元素获取
    const currentScoreEl = document.getElementById('currentScore');
    const startThresholdEl = document.getElementById('startThreshold');
    const startTimeEl = document.getElementById('startTime');
    const resultTextEl = document.getElementById('resultText');
    const errorMsgEl = document.getElementById('errorMsg');

    const iconScoreEl = document.getElementById('iconScore');
    const iconThresholdEl = document.getElementById('iconThreshold');
    const iconTimeEl = document.getElementById('iconTime');
    
    // --- 核心逻辑函数 ---

    function resetResult() {
        resultTextEl.innerHTML = `
            <span class="time-text time-placeholder">--:--</span> 时可以抢空投！<br>
            请在 <span class="time-text time-placeholder">--:--</span> 之前做好准备
        `;
        errorMsgEl.style.display = 'none';
        errorMsgEl.innerText = '';
    }

    function calculate() {
        const currentScoreVal = currentScoreEl.value;
        const startThresholdVal = startThresholdEl.value;
        const startTimeVal = startTimeEl.value;

        // 统一控制数字输入框的清空图标显示/隐藏
        handleNumericIconState(currentScoreEl, iconScoreEl);
        handleNumericIconState(startThresholdEl, iconThresholdEl);
        
        // 专门处理时间输入框的图标状态切换 (有值清空，无值时钟)
        handleTimeIconState();

        // 基础非空校验：只要有一个为空，就恢复默认文案
        if (currentScoreVal === '' || startThresholdVal === '' || startTimeVal === '') {
            resetResult();
            return;
        }

        const currentScore = parseInt(currentScoreVal);
        const startThreshold = parseInt(startThresholdVal);

        errorMsgEl.style.display = 'none';
        errorMsgEl.innerText = '';

        // 业务规则校验：最低70分
        if (currentScore < 70) {
            errorMsgEl.style.display = 'block';
            errorMsgEl.innerText = '当前积分低于最低门槛 (70分)，无法参与活动。';
            resultTextEl.innerHTML = '<span style="color:#aaa">积分不足，无法参与</span>';
            return;
        }

        // 解析时间
        const [hours, minutes] = startTimeVal.split(':').map(Number);
        const targetDate = new Date();
        targetDate.setHours(hours);
        targetDate.setMinutes(minutes);
        targetDate.setSeconds(0);
        targetDate.setMilliseconds(0);

        let minutesToAdd = 0;

        if (currentScore >= startThreshold) {
            minutesToAdd = 0;
        } else {
            const scoreDiff = startThreshold - currentScore;
            // 向上取整周期
            const cycles = Math.ceil(scoreDiff / 5); 
            minutesToAdd = cycles * 5;
        }

        // 得出结果时间
        targetDate.setMinutes(targetDate.getMinutes() + minutesToAdd);

        const resH = String(targetDate.getHours()).padStart(2, '0');
        const resM = String(targetDate.getMinutes()).padStart(2, '0');
        const timeStr = `${resH}:${resM}`;

        // 更新 UI (使用红色高亮样式 time-active)
        resultTextEl.innerHTML = `
            <span class="time-text time-active">${timeStr}</span> 时可以抢空投！<br>
            请在 <span class="time-text time-active">${timeStr}</span> 之前做好准备
        `;
    }

    // --- 图标控制逻辑 ---

    /**
     * 控制数字输入框的清空图标显示/隐藏
     */
    function handleNumericIconState(inputEl, iconEl) {
        if (inputEl.value.length > 0) {
            iconEl.style.display = 'block';
        } else {
            iconEl.style.display = 'none';
        }
    }
    
    /**
     * 专门处理时间输入框的图标状态切换 (精简版)
     */
    function handleTimeIconState() {
        if (startTimeEl.value) {
            // 有值时：清空图标 (icon-clear)
            iconTimeEl.classList.remove('icon-time');
            iconTimeEl.classList.add('icon-clear');
            iconTimeEl.style.cursor = 'pointer';
        } else {
            // 无值时：时间图标 (icon-time)
            iconTimeEl.classList.remove('icon-clear');
            iconTimeEl.classList.add('icon-time');
            iconTimeEl.style.cursor = 'default';
        }
    }

    /**
     * 清空输入框并重新计算
     * @param {HTMLElement} inputEl 输入框元素
     * @param {HTMLElement} iconEl 图标元素 (可选，用于数字框)
     */
    function clearInputAndCalculate(inputEl, iconEl) {
        inputEl.value = '';
        if (iconEl) {
            iconEl.style.display = 'none';
        }
        calculate();
    }

    // --- 绑定事件 ---

    // 绑定数字输入框的清空事件
    iconScoreEl.addEventListener('click', () => clearInputAndCalculate(currentScoreEl, iconScoreEl));
    iconThresholdEl.addEventListener('click', () => clearInputAndCalculate(startThresholdEl, iconThresholdEl));
    
    // 绑定时间输入框的清空事件
    iconTimeEl.addEventListener('click', () => {
        // 只有在是清空图标状态 (icon-clear) 时才触发清空
        if (iconTimeEl.classList.contains('icon-clear')) {
             clearInputAndCalculate(startTimeEl);
        }
    });

    // 绑定所有输入变化到计算函数
    currentScoreEl.addEventListener('input', calculate);
    startThresholdEl.addEventListener('input', calculate);
    startTimeEl.addEventListener('input', calculate);

    // 页面加载时先初始化一次
    calculate(); 

</script>

</body>
</html>